<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Spin & Reward</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  margin:0;
  padding:20px;
  font-family: Arial, sans-serif;
  background:#121212;
  color:#fff;
  text-align:center;
}

#wheelContainer {
  position:relative;
  width:300px;
  height:300px;
  margin:20px auto;
}

canvas {
  border-radius:50%;
  background:#222;
}

#pointer {
  position:absolute;
  top:-10px;
  left:50%;
  transform:translateX(-50%) rotate(180deg);
  width:0;
  height:0;
  border-left:12px solid transparent;
  border-right:12px solid transparent;
  border-bottom:20px solid red;
}

#spinBtn {
  margin-top:20px;
  padding:16px 45px;
  font-size:18px;
  font-weight:bold;
  background:#f1c40f;
  color:#000;
  border:none;
  border-radius:40px;
  display:block;
  margin-left:auto;
  margin-right:auto;
}

#spinBtn:disabled {
  background:#555;
  color:#aaa;
}

/* âœ… WITHDRAW SOTTO SPIN */
#withdrawBtn {
  display:block;
  margin:14px auto 0 auto;
  padding:12px 36px;
  font-size:16px;
  font-weight:bold;
  background:#22c55e;
  color:#ffffff;
  border:none;
  border-radius:40px;
  cursor:not-allowed;
  opacity:1;
}

#withdrawBtn.enabled {
  cursor:pointer;
}

.small {
  font-size:12px;
  color:#aaa;
  margin-top:6px;
}
</style>

<!-- FIREBASE -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
  import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-analytics.js";

  const firebaseConfig = {
    apiKey: "AIzaSyCdXbufEBn45FH-JJpRrWmbSpdY_n-DZf4",
    authDomain: "spinrewardapp-56e7f.firebaseapp.com",
    projectId: "spinrewardapp-56e7f",
    storageBucket: "spinrewardapp-56e7f.firebasestorage.app",
    messagingSenderId: "373874094522",
    appId: "1:373874094522:web:4d2b83a58d1cde08c02d83",
    measurementId: "G-Z604SL4NPK"
  };

  const app = initializeApp(firebaseConfig);
  const analytics = getAnalytics(app);
</script>

</head>

<body>

<h2>ðŸŽ¯ Spin & Reward</h2>

<div><strong>Points:</strong> <span id="points">0</span></div>

<div class="small">
<strong>15,000 Points â€“ Reward</strong><br>
The reward is subject to availability and verification.<br>
Equivalent up to 10 USD
</div>

<div id="wheelContainer">
  <div id="pointer"></div>
  <canvas id="wheel" width="300" height="300"></canvas>
</div>

<button id="spinBtn">SPIN</button>
<button id="withdrawBtn" disabled>WITHDRAW</button>

<div class="small" id="status"></div>
<div class="small" id="timer"></div>

<script>
// ---------------- CONFIG ----------------
const DAILY_SPINS = 2;
const COOLDOWN = 24 * 60 * 60 * 1000;

const sectors = [
  { label: "120 PT", value: 120, color: "#27ae60" },
  { label: "100 PT", value: 100, color: "#2ecc71" },
  { label: "50 PT",  value: 50,  color: "#f1c40f" },
  { label: "25 PT",  value: 25,  color: "#f39c12" },
  { label: "15 PT",  value: 15,  color: "#e67e22" },
  { label: "15 PT",  value: 15,  color: "#d35400" },
  { label: "10 PT",  value: 10,  color: "#c0392b" },
  { label: "0 PT",   value: 0,   color: "#7f8c8d" }
];

// ---------------- STORAGE ----------------
let points = Number(localStorage.getItem("points")) || 0;
let spins = Number(localStorage.getItem("spins")) || 0;
let cooldownStart = Number(localStorage.getItem("cooldownStart")) || 0;

let startPerf = performance.now();
let savedElapsed = Number(localStorage.getItem("elapsed")) || 0;

// ---------------- UI ----------------
const canvas = document.getElementById("wheel");
const ctx = canvas.getContext("2d");
const btn = document.getElementById("spinBtn");
const withdrawBtn = document.getElementById("withdrawBtn");
const pointsEl = document.getElementById("points");
const statusEl = document.getElementById("status");
const timerEl = document.getElementById("timer");

pointsEl.textContent = points;

// ---------------- TIME ----------------
function elapsed() {
  return savedElapsed + (performance.now() - startPerf);
}

document.addEventListener("visibilitychange", () => {
  if (document.hidden) {
    savedElapsed = elapsed();
    localStorage.setItem("elapsed", savedElapsed);
  }
});

// ---------------- DRAW WHEEL ----------------
function drawWheel() {
  const r = canvas.width / 2;
  const arc = (2 * Math.PI) / sectors.length;

  sectors.forEach((s, i) => {
    const angle = i * arc;

    ctx.beginPath();
    ctx.moveTo(r, r);
    ctx.arc(r, r, r, angle, angle + arc);
    ctx.fillStyle = s.color;
    ctx.fill();

    ctx.save();
    ctx.translate(r, r);
    ctx.rotate(angle + arc / 2);
    ctx.textAlign = "right";
    ctx.fillStyle = "#fff";
    ctx.font = "bold 14px Arial";
    ctx.fillText(s.label, r - 10, 5);
    ctx.restore();
  });
}

drawWheel();

// ---------------- COOLDOWN ----------------
function checkCooldown() {
  if (spins < DAILY_SPINS) {
    btn.disabled = false;
    timerEl.textContent = "";
    return;
  }

  const rem = COOLDOWN - (elapsed() - cooldownStart);
  if (rem <= 0) {
    spins = 0;
    localStorage.setItem("spins", 0);
    btn.disabled = false;
    timerEl.textContent = "";
  } else {
    btn.disabled = true;
    const h = Math.floor(rem / 3600000);
    const m = Math.floor((rem % 3600000) / 60000);
    timerEl.textContent = `Next spin in ${h}h ${m}m`;
  }
}

// ---------------- WITHDRAW ----------------
const WITHDRAW_POINTS = 15000;
const WITHDRAW_FORM = "https://forms.gle/kKz8kSW8aoH7Dm7K7";

function updateWithdrawButton() {
  if (points >= WITHDRAW_POINTS) {
    withdrawBtn.disabled = false;
    withdrawBtn.classList.add("enabled");
  }
}

withdrawBtn.addEventListener("click", () => {
  if (!withdrawBtn.disabled) {
    window.open(WITHDRAW_FORM, "_blank");
  }
});

// ---------------- SPIN FLOW ----------------
btn.onclick = () => {
  statusEl.textContent = "Loading ad...";
  btn.disabled = true;

  if (window.Android && Android.requestRewardAd) {
    Android.requestRewardAd();
  }
};

window.onAdCompleted = function () {
  startSpin();
};

function startSpin() {
  spins++;
  localStorage.setItem("spins", spins);

  if (spins === DAILY_SPINS) {
    cooldownStart = elapsed();
    localStorage.setItem("cooldownStart", cooldownStart);
  }

  const index = Math.floor(Math.random() * sectors.length);
  const arc = 360 / sectors.length;
  const rotation = 720 + (360 - index * arc - arc / 2);

  canvas.style.transition = "transform 4s cubic-bezier(.17,.67,.12,.99)";
  canvas.style.transform = `rotate(${rotation}deg)`;

  setTimeout(() => {
    const reward = sectors[index].value;
    points += reward;
    localStorage.setItem("points", points);
    pointsEl.textContent = points;
    statusEl.textContent = `You earned ${reward} points`;
    checkCooldown();
    updateWithdrawButton();
  }, 4000);
}

// ---------------- INIT ----------------
updateWithdrawButton();
checkCooldown();
</script>

</body>
</html>
